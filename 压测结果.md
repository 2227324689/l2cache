# 压测
# 场景1 - 非同步方式加载数据
## 配置
```yaml
spring:
  application:
    name: study-spring-demo
  cache:
    multi:
      # 一级缓存
      caffeine:
        # 是否构建异步Caffeine true 是 false 否
        asyncCache: false
        # 是否自动刷新过期缓存 true 是 false 否
        autoRefreshExpireCache: false
        # 缓存刷新调度线程池的大小
        refreshPoolSize: 1
        # 缓存刷新的频率(秒)
        refreshPeriod: 5
        # 创建缓存的默认配置（完全与SpringCache中的Caffeine实现的配置一致）
        # 如果expireAfterWrite和expireAfterAccess同时存在，以expireAfterWrite为准。
        # 推荐用法：refreshAfterWrite 和 @Cacheable(sync=true)
        defaultSpec: initialCapacity=10,maximumSize=200,refreshAfterWrite=30s,recordStats
        # 设置指定缓存名的创建缓存配置(如：userCache为缓存名称)
        specs:
          userCache: initialCapacity=10,maximumSize=200,expireAfterWrite=30s
      # 二级缓存
      redis:
        topic: cache:caffeine:redis:topic
```

```java
@Service
public class CaffeineCacheService {
    // sync=false,即采用非同步方式加载数据。也就是说并发场景下未做同步控制。
    @Cacheable(value = "userCache", key = "#userId")
    public User queryUser(String userId) {
        User user = new User(userId, "addr");
        try {
            Thread.sleep(1000);// 模拟加载数据的耗时
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        logger.info("加载数据:{}", user);
        return user;
    }
}
```

## 测试结果
> @Cacheable(sync=false),即采用非同步方式加载数据。也就是说并发场景下未做同步控制。
> 
> 通过分析下面的日志发现，存在如下问题：
>
> 1、同一个key在同一时刻会有多个线程去加载数据，在高并发场景下，这是一个典型的同一个key的`缓存击穿`场景。
> 
> 2、`后加载完数据的线程`会覆盖`前面线程加载的数据`，这是一个类似ABA的问题，当然一般情况下，查询到的数据是一样的，但在对数据变更状态要求严格的场景下要特别注意这个点。
>
> 结论：该方式不适用于高并发场景。

## 测试日志
### 第一次获取缓存(无缓存项)
```text

2020-05-27 17:38:07.865  INFO 32800 --- [nio-8081-exec-1] .l.CaffeineRedisCacheProperties$Caffeine : create a native Caffeine Cache, name=userCache, spec=initialCapacity=10,maximumSize=200,expireAfterWrite=30s
2020-05-27 17:38:07.865  INFO 32800 --- [nio-8081-exec-1] c.c.l.context.CaffeineRedisCacheManager  : create a native Caffeine Cache instance, name=userCache
2020-05-27 17:38:07.869  INFO 32800 --- [nio-8081-exec-1] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:38:07.869 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:38:08.062  INFO 32800 --- [nio-8081-exec-9] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:38:08.062 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:38:08.263  INFO 32800 --- [nio-8081-exec-2] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:38:08.263 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:38:08.464  INFO 32800 --- [nio-8081-exec-3] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:38:08.464 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:38:08.663  INFO 32800 --- [nio-8081-exec-7] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:38:08.664 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:38:09.870  INFO 32800 --- [nio-8081-exec-1] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.870 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.872 DEBUG 32800 --- [enerContainer-5] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:38:09.877 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.879 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.881 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.882 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.883 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.885 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.886 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.887 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:09.889 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572287870)
2020-05-27 17:38:10.063  INFO 32800 --- [nio-8081-exec-9] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.063 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.065 DEBUG 32800 --- [enerContainer-6] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:38:10.069 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.071 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.073 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.075 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.076 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.078 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.081 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.083 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.085 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288062)
2020-05-27 17:38:10.264  INFO 32800 --- [nio-8081-exec-2] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.264 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.266 DEBUG 32800 --- [enerContainer-7] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:38:10.269 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.271 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.272 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.274 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.275 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.277 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.279 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.281 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.283 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288263)
2020-05-27 17:38:10.464  INFO 32800 --- [nio-8081-exec-3] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.464 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.466 DEBUG 32800 --- [enerContainer-8] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:38:10.469 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.472 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.474 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.476 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.478 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.480 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.482 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.484 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.486 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288464)
2020-05-27 17:38:10.664  INFO 32800 --- [nio-8081-exec-7] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.664 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.666 DEBUG 32800 --- [enerContainer-9] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:38:10.668 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.670 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.671 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.673 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.674 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.676 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.678 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.679 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)
2020-05-27 17:38:10.681 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572288664)


```

### 第二次获取缓存(缓存项已过期)
```text

2020-05-27 17:39:10.529  INFO 32800 --- [nio-8081-exec-4] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:39:10.530 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:39:10.727  INFO 32800 --- [nio-8081-exec-2] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:39:10.727 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:39:10.926  INFO 32800 --- [io-8081-exec-10] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:39:10.926 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:39:11.127  INFO 32800 --- [nio-8081-exec-5] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:39:11.127 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:39:11.329  INFO 32800 --- [nio-8081-exec-9] c.coy.l2cache.context.CustomCacheLoader  : [CustomCacheLoader] caffeineRedisCache is null direct return null, key=cck
2020-05-27 17:39:11.329 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=null
2020-05-27 17:39:12.530  INFO 32800 --- [nio-8081-exec-4] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.530 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.533 DEBUG 32800 --- [nerContainer-10] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:39:12.535 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.537 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.539 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.540 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.541 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.542 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.544 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.545 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.546 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350530)
2020-05-27 17:39:12.728  INFO 32800 --- [nio-8081-exec-2] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.728 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.730 DEBUG 32800 --- [nerContainer-11] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:39:12.733 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.735 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.737 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.739 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.741 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.743 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.744 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.746 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.747 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350727)
2020-05-27 17:39:12.928  INFO 32800 --- [io-8081-exec-10] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.928 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.930 DEBUG 32800 --- [nerContainer-12] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:39:12.932 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.934 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.935 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.936 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.938 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.939 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.941 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.943 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:12.945 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572350927)
2020-05-27 17:39:13.128  INFO 32800 --- [nio-8081-exec-5] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.128 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.131 DEBUG 32800 --- [nerContainer-13] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:39:13.133 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.135 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.137 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.138 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.140 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.141 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.144 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.146 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.147 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351127)
2020-05-27 17:39:13.329  INFO 32800 --- [nio-8081-exec-9] c.c.l.example.CaffeineCacheService       : 加载数据:User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.329 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : put cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.331 DEBUG 32800 --- [nerContainer-14] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCache, key=cck, optType=refresh
2020-05-27 17:39:13.333 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.334 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.335 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.337 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.338 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.339 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.341 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.343 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)
2020-05-27 17:39:13.344 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get cache, cacheName=userCache, key=cck, value=User(name=cck, addr=addr, currTime=1590572351329)


```


# 场景2 - 同步方式加载数据 【建议-最佳实践用法】
## 配置
```yaml
spring:
  application:
    name: study-spring-demo
  cache:
    multi:
      # 一级缓存
      caffeine:
        # 是否构建异步Caffeine true 是 false 否
        asyncCache: false
        # 是否自动刷新过期缓存 true 是 false 否
        autoRefreshExpireCache: false
        # 缓存刷新调度线程池的大小
        refreshPoolSize: 1
        # 缓存刷新的频率(秒)
        refreshPeriod: 5
        # 创建缓存的默认配置（完全与SpringCache中的Caffeine实现的配置一致）
        # 如果expireAfterWrite和expireAfterAccess同时存在，以expireAfterWrite为准。
        # 推荐用法：refreshAfterWrite 和 @Cacheable(sync=true)
        defaultSpec: initialCapacity=10,maximumSize=200,refreshAfterWrite=30s,recordStats
        # 设置指定缓存名的创建缓存配置(如：userCache为缓存名称)
        specs:
          userCacheSync: initialCapacity=10,maximumSize=200,refreshAfterWrite=30s
      # 二级缓存
      redis:
        topic: cache:caffeine:redis:topic
```

```java
@Service
public class CaffeineCacheService {
    // sync=true,即采用同步方式加载数据。同步控制是通过`Caffeine`本身的机制来实现的。
    @Cacheable(value = "userCacheSync", key = "#userId", sync = true)
    public User queryUserSync(String userId) {
        User user = new User(userId, "addr");
        try {
            Thread.sleep(2000);// 模拟加载数据的耗时
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        logger.info("加载数据:{}", user);
        return user;
    }
}
```

## 测试结果
> @Cacheable(sync=true),即采用同步方式加载数据。同步控制是通过`Caffeine`本身的机制来实现的。
> 
> 通过分析下面的日志发现，存在如下问题：
>
> 1、第一次获取缓存(无缓存项)：
>
> 只有一个线程加载数据，其他线程均被阻塞。
>
> 虽然解决了缓存击穿的问题，但是在高并发场景下因为阻塞带来的性能问题。针对该场景可以通过缓存预热来解决。
>
> 2、第二次获取缓存(缓存项已过期)
>
> 只有一个名为`onPool-worker-2`的线程加载数据，从名字和结合日志可以看出：加载数据的线程是一个线程池中异步执行的。并且数据加载完以前的请求是返回的旧数据，数据加载完以后返回的是新数据。
>
> 保证缓存可用性的同时，也保证了缓存的性能（因为等同于所有请求全部从内存中获取数据，所以性能是有保障的）。
>
> 结论：高并发场景下推荐适用该方式。可以理解为最佳实践用法。


## 测试日志
### 第一次获取缓存(无缓存项)
> 只有一个线程加载数据，其他线程均被阻塞。
>
> 针对该场景可以通过缓存预热来解决。
```text

2020-05-27 17:20:51.737  INFO 32800 --- [nio-8081-exec-1] .l.CaffeineRedisCacheProperties$Caffeine : create a native Caffeine Cache, name=userCacheSync, spec=initialCapacity=10,maximumSize=200,refreshAfterWrite=30s,recordStats
2020-05-27 17:20:51.738  INFO 32800 --- [nio-8081-exec-1] c.c.l.context.CaffeineRedisCacheManager  : create a native Caffeine Cache instance, name=userCacheSync
2020-05-27 17:20:51.784 DEBUG 32800 --- [nio-8081-exec-1] com.coy.l2cache.context.LoadFunction     : [LoadFunction] load cache, cacheName=userCacheSync, key=cck
2020-05-27 17:20:53.796  INFO 32800 --- [nio-8081-exec-1] c.c.l.example.CaffeineCacheService       : 加载数据:[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.796 DEBUG 32800 --- [nio-8081-exec-1] com.coy.l2cache.context.LoadFunction     : [LoadFunction] load data from method, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.836 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.836 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.838 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.840 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.885 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.885 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.885 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.885 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.888 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.888 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.888 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.888 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.890 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.891 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.890 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.891 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.893 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.893 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.893 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.893 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.895 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.895 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.895 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.895 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.897 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.897 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.897 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.897 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.899 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.899 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.899 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.899 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.900 DEBUG 32800 --- [enerContainer-2] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCacheSync, key=cck, optType=refresh
2020-05-27 17:20:53.901 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.901 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.901 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.902 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.904 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.904 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.904 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:53.904 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.043 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.046 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.047 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.050 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.052 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.054 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.056 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.058 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.060 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:20:54.072 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]


```

### 第二次获取缓存(缓存项已过期)
> 只有一个线程加载数据，并且是异步执行的。并且数据加载完以前的请求是返回的旧数据，数据加载完以后返回的是新数据。
>
> 保证缓存可用性的同时，也保证了缓存的性能。
```text
2020-05-27 17:22:19.572 DEBUG 32800 --- [onPool-worker-2] com.coy.l2cache.context.LoadFunction     : [LoadFunction] load cache, cacheName=userCacheSync, key=cck
2020-05-27 17:22:19.573 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:19.576 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:19.577 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:19.580 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:19.581 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:19.583 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:19.584 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:19.586 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:19.587 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:19.589 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.169 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.171 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.172 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.173 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.176 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.178 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.179 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.180 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.182 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.183 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.768 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.770 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.772 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.774 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.775 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.776 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.777 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.779 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.780 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:20.781 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.368 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.372 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.374 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.376 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.377 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.379 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.381 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.382 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.384 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.385 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571251795), User(name=cck, addr=addr2, currTime=1590571251795), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571251795)]
2020-05-27 17:22:21.574  INFO 32800 --- [onPool-worker-2] c.c.l.example.CaffeineCacheService       : 加载数据:[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.574 DEBUG 32800 --- [onPool-worker-2] com.coy.l2cache.context.LoadFunction     : [LoadFunction] load data from method, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.577 DEBUG 32800 --- [enerContainer-3] c.c.l.listener.CacheMessageListener      : [RedisCacheTopicMessage] not deal cache instanceId is same, instanceId=bfbedc2d3e6c4822b81b9cc16238c33e, cacheName=userCacheSync, key=cck, optType=refresh
2020-05-27 17:22:21.968 DEBUG 32800 --- [nio-8081-exec-7] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.970 DEBUG 32800 --- [nio-8081-exec-8] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.971 DEBUG 32800 --- [nio-8081-exec-6] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.972 DEBUG 32800 --- [nio-8081-exec-4] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.974 DEBUG 32800 --- [io-8081-exec-10] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.976 DEBUG 32800 --- [nio-8081-exec-5] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.977 DEBUG 32800 --- [nio-8081-exec-1] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.978 DEBUG 32800 --- [nio-8081-exec-9] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.979 DEBUG 32800 --- [nio-8081-exec-2] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]
2020-05-27 17:22:21.980 DEBUG 32800 --- [nio-8081-exec-3] c.c.l.c.AbstractCaffeineRedisCache       : LoadingCache.get(key, callable) cache, cacheName=userCacheSync, key=cck, value=[User(name=cck, addr=addr1, currTime=1590571339573), User(name=cck, addr=addr2, currTime=1590571339573), User(name=cck, addr=-addr-addr-addr-addr-addr-addr, currTime=1590571339573)]

```